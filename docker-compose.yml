version: "3.3"
services:
  mongo:
    image: mongo
    container_name: mongo
    restart: always
    ports:
      - 27017:27017
    environment:
      - MONGO_INITDB_ROOT_USERNAME=root
      - MONGO_INITDB_ROOT_PASSWORD=example
    volumes:
      - ./data/mongo:/data/db
    #   - ./mongo-init:/docker-entrypoint-initdb.d
    #   - ./mongo-init/entrypoint.sh:/docker-entrypoint-initdb.d/entrypoint.sh
    # entrypoint: ["bash", "/docker-entrypoint-initdb.d/entrypoint.sh"]

  parse-server:
    image: elestio/parse-server:${SOFTWARE_VERSION_TAG}
    container_name: parse-server
    hostname: parse-server
    restart: always
    ports:
      - 1337:1337
    links:
      - mongo
    environment:
      - PARSE_SERVER_APPLICATION_ID=${PARSE_SERVER_APPLICATION_ID}
      - PARSE_SERVER_MASTER_KEY=${MASTER_KEY}
      - PARSE_SERVER_REST_API_KEY=${REST_KEY}
      - PARSE_SERVER_DATABASE_URI=mongodb://root:example@${HOST_IP}:27017/admin
      - PARSE_SERVER_START_LIVE_QUERY_SERVER=1
      # - PARSE_SERVER_LIVE_QUERY={"classNames":["people","monitor"]}
      - PARSE_SERVER_MASTER_KEY_IPS=0.0.0.0/0
      # - PARSE_SERVER_ALLOW_CLIENT_CLASS_CREATION=allowClientClassCreation

  dashboard:
    image: elestio/parse-dashboard:${SOFTWARE_VERSION_TAG}
    container_name: dashboard
    restart: always
    ports:
      - "4040:4040"
    links:
      - parse-server
    environment:
      - PARSE_DASHBOARD_SERVER_URL=http://${HOST_IP}:1337/parse
      - PARSE_DASHBOARD_APP_NAME=${APP_NAME}
      - PARSE_DASHBOARD_APP_ID=${PARSE_SERVER_APPLICATION_ID}
      - PARSE_DASHBOARD_MASTER_KEY=${MASTER_KEY}
      - PARSE_DASHBOARD_ALLOW_INSECURE_HTTP=1
      - PARSE_DASHBOARD_USER_ID=${ADMIN_USERNAME}
      - PARSE_DASHBOARD_USER_PASSWORD=${ADMIN_PASSWORD}
